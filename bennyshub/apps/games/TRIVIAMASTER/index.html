<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ტექნიკური ქვიზი</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
</head>
<body>
    <div id="app">
        <!-- Background Particles -->
        <div id="particles"></div>

        <!-- Header / HUD -->
        <header id="game-header" class="hidden">
            <div class="hud-item" id="score-display"><i class="fas fa-star"></i> <span id="score">0</span></div>
            <div class="hud-item" id="streak-display"><i class="fas fa-fire"></i> <span id="streak">0</span>x</div>
            <div class="hud-item" id="progress-display">Q: <span id="current-q">1</span>/<span id="total-q">10</span></div>
            <button id="pause-btn" data-action="pause-game" aria-label="Pause Game"><i class="fas fa-pause"></i></button>
        </header>

        <!-- Main Menu -->
        <section id="main-menu" class="screen active">
            <h1 class="title">ტექნიკური ქვიზი</h1>
            <div class="menu-options">
                <button class="scannable menu-btn" data-action="select-game">
                    <i class="fas fa-gamepad"></i> თამაშის არჩევა
                </button>
                <button class="scannable menu-btn" data-action="settings">
                    <i class="fas fa-cog"></i> პარამეტრები
                </button>
                <a class="scannable menu-btn" href="https://trivias-flax.vercel.app/" target="_blank" rel="noopener">
                    <i class="fas fa-times"></i> თამაშიდან გამოსვლა
                </a>
            </div>
        </section>

        <!-- Game Selection Screen -->
        <section id="game-selection" class="screen">
            <h2>თამაშის არჩევა</h2>
            <div id="games-list" class="grid-container">
                <!-- Games injected by JS -->
            </div>
            <button class="scannable back-btn" data-action="back-to-menu" style="margin-top: 20px;">უკან</button>
        </section>

        <!-- Category Selection -->
        <section id="category-selection" class="screen">
            <h2>კატეგორიის არჩევა</h2>
            <div id="category-grid" class="grid-container">
                <!-- Categories injected by JS -->
            </div>
        </section>

        <!-- Game Screen -->
        <section id="game-screen" class="screen">
            <div id="answers-container" class="grid-container">
                <!-- Answers injected by JS -->
            </div>
            <div id="question-container">
                <div id="media-container" data-action="view-media"></div>
                <div id="question-text-wrapper" class="scannable" data-action="repeat-question">
                    <h2 id="question-text">კითხვა აქ?</h2>
                </div>
            </div>
            <div class="game-controls">
                <!-- Controls -->
            </div>
        </section>

        <!-- Feedback Screen -->
        <section id="feedback-screen" class="screen">
            <div class="feedback-content">
                <h2 id="feedback-title">სწორია!</h2>
                <p id="feedback-message">+100 ქულა</p>
                <div id="feedback-animation"></div>
                <button class="scannable next-btn" id="next-question-btn" data-action="next-question">შემდეგი კითხვა</button>
            </div>
        </section>

        <!-- Settings Screen -->
        <section id="settings-screen" class="screen">
            <h2>პარამეტრები</h2>
            <div class="settings-list grid-container-settings">
                <div class="setting-item scannable" data-action="toggle-games-source">
                    <span>თამაშის წყარო</span>
                    <span id="games-source-status">ALL</span>
                </div>
                <div class="setting-item scannable" data-action="toggle-tts">
                    <span>ტექსტიდან ხმაში</span>
                    <span id="tts-status">ON</span>
                </div>
                <div class="setting-item scannable" data-action="toggle-autoscan">
                    <span>ავტომატური სკანირება</span>
                    <span id="autoscan-status">OFF</span>
                </div>
                <div class="setting-item scannable" data-action="cycle-speed">
                    <span>სკანირების სიჩქარე</span>
                    <span id="speed-status">Medium</span>
                </div>
                <div class="setting-item scannable" data-action="cycle-theme">
                    <span>თემა</span>
                    <span id="theme-status">Default</span>
                </div>
                <div class="setting-item scannable" data-action="cycle-voice">
                    <span>ხმოვანი</span>
                    <span id="voice-status">Default</span>
                </div>
                
                <div class="setting-item scannable" data-action="clear-custom-games">
                    <span>ლოკალური თამაშების წაშლა</span>
                    <i class="fas fa-trash"></i>
                </div>
            </div>
            <button class="scannable back-btn" data-action="settings-back">უკან</button>
        </section>

        <!-- High Scores Screen -->
        <section id="highscores-screen" class="screen">
            <h2>საუკეთესო ქულები</h2>
            <ul id="highscore-list">
                <!-- Scores injected by JS -->
            </ul>
            <button class="scannable back-btn" data-action="back-to-menu">უკან</button>
        </section>

        <!-- End Game Screen -->
        <section id="end-screen" class="screen">
            <h2>თამაში დასრულდა!</h2>
            <p>საბოლოო ქულა: <span id="final-score">0</span></p>
            <p>საუკეთესო ქულა: <span id="new-highscore-msg"></span></p>
            <div class="menu-options">
                <button class="scannable menu-btn" data-action="play-again">თავიდან თამაში</button>
                <button class="scannable menu-btn" data-action="back-to-menu">მთავარი გვერდი</button>
            </div>
        </section>
        
        <!-- Pause Overlay -->
        <div id="pause-overlay" class="hidden">
            <div class="pause-content">
                <h2>შეჩერებულია</h2>
                <button class="scannable" data-action="resume">გაგრძელება</button>
                <button class="scannable" data-action="settings">პარამეტრები</button>
                <button class="scannable" data-action="quit">მთავარი გვერდი</button>
            </div>
        </div>

        <!-- Editor Warning Overlay -->
        <div id="editor-warning-overlay" class="hidden">
            <div class="pause-content">
                <h2>გაფრთხილება</h2>
                <p style="text-align: center; font-size: 1.2rem; margin-bottom: 20px;">თამაშის რედაქტორის გახსნა დატოვებს ამ საიტს და გახსნის რედაქტორს. ვერ შეძლებთ სკანირებას და არჩევას spacebar-ით და enter-ით.</p>
                <button class="scannable" data-action="cancel-editor">გაუქმება</button>
                <button class="scannable" data-action="open-editor">გაგრძელება</button>
            </div>
        </div>

        <!-- Load Game Warning Overlay -->
        <div id="load-game-warning-overlay" class="hidden">
            <div class="pause-content">
                <h2>საჭიროა მაუსის გამოყენება</h2>
                <p style="text-align: center; font-size: 1.2rem; margin-bottom: 20px;">კასტომ თამაშის ფაილის არჩევა საჭიროებს მაუსის გამოყენებას კომპიუტერის ფაილური სისტემის სანავიგაციოდ. სკანირების სისტემა ვერ მართავს ფაილ პიკერის დიალოგს.</p>
                <button class="scannable" data-action="cancel-load-game">გაუქმება</button>
                <button class="scannable" data-action="proceed-load-game">გაგრძელება</button>
            </div>
        </div>

    </div>

    <!-- Audio Elements (Placeholders for user to replace if they want real files, but we will use Web Audio API by default) -->
    <!-- <audio id="bg-music" loop src="music.mp3"></audio> -->

    <!-- Image Popup Overlay -->
    <div id="image-popup-overlay" class="hidden">
        <img id="popup-image" src="" alt="Enlarged Answer">
        <div id="popup-video-container" class="hidden"></div>
    </div>

    <!-- Load shared voice manager first -->
    <script src="../../../shared/voice-manager.js"></script>
    <script src="../../../shared/ios-audio-fix.js"></script>
    <script src="../../../shared/scan-manager.js"></script>
    <script src="script.js"></script>
</body>
</html>
